function showSuccess(e){notif({msg:"<i class='fa fa-check-circle fa-fw'></i> "+e,type:"success",position:"center",width:400,autohide:!0,opacity:1,fade:!0,clickable:!0,multiline:!0})}function showWarning(e){notif({msg:"<i class='fa fa-exclamation-circle fa-fw'></i> "+e,type:"warning",position:"center",width:400,autohide:!1,opacity:1,fade:!0,multiline:!0})}function showError(e){notif({msg:'<i class="fa fa-exclamation-triangle fa-fw"></i> '+e,type:"error",position:"center",width:400,autohide:!1,opacity:1,fade:!0,multiline:!0})}function showInfo(e){notif({msg:'<i class="fa fa-info-circle fa-fw"></i> '+e,type:"info",position:"center",width:400,autohide:!1,opacity:1,fade:!0,multiline:!0})}function BookmarkToggle(e,t){var a="/bookmark_class/"+e+"/"+t;$.ajax({url:a,dataType:"json",type:"GET",success:function(a){if(a[0].success<1)return showError(a[0].message),!1;-1==t?$("#bookmark_"+e).html('<a onClick="BookmarkToggle( '+e+', 1 )"><i class="fa fa-bookmark-o fa-fw"></i></a>'):$("#bookmark_"+e).html('<a onClick="BookmarkToggle( '+e+', -1 )"><i class="fa fa-bookmark fa-fw"></i></a>'),showSuccess(a[0].message)},error:function(){showError("An error occurred, and we could not bookmark this Class. Please try again later.")}})}function selectMail(e,t){var a="/user/mail/"+e+"/"+t;$.ajax({url:a,dataType:"json",type:"GET",success:function(t){if(t[0].success<1)return showError(t[0].message),!1;if($("#user-mail-display").html(t[0].content),1==t[0].increment){var a=$("span#unread-count").text();a<99&&$("span#notification-count").html(a-1),$("span#unread-count").html(a-1),$("#icon-"+e).html('<i class="fa fa-envelope-open"></i>')}},error:function(){showError("<strong>Wait, what??</strong><br>An error occurred, and we could not message you indicated. Please try again later.")}})}function selectFolder(e){var t="/user/mail_folder/"+e;$.ajax({url:t,dataType:"json",type:"GET",success:function(t){if(t[0].success<1)return showError(t[0].message),!1;$(".user-mail-list-wrapper").html(t[0].mail_list),$("#folder-name").html("Folder: <small>"+e+" ( Messages: "+t[0].mail_count+' | Unread: <span id="unread-count">'+t[0].unread_count+"</span> )</small>"),$("#user-mail-display").html('<div class="text-center"><h3>No Mail Selected</h3></div>'),$("#filter-mail").html('<a class="button tiny warning" id="filter-button" onClick="filterFolder( \''+e+"', 1 );\">Hide System Messages</a>")},error:function(){showError("<strong>Wait, what??</strong><br>An error occurred, and we could not message you indicated. Please try again later.")}})}function filterFolder(e,t){var a="/user/mail_folder/"+e+"/"+t;$.ajax({url:a,dataType:"json",type:"GET",success:function(a){if(a[0].success<1)return showError(a[0].message),!1;$(".user-mail-list-wrapper").html(a[0].mail_list);var r=" (filtered)",o=0,n="Show";1!=t&&(r="",o=1,n="Hide"),$("#folder-name").html("Folder"+r+": <small>"+e+" ( Messages: "+a[0].mail_count+' | Unread: <span id="unread-count">'+a[0].unread_count+"</span> )</small>"),$("#user-mail-display").html('<div class="text-center"><h3>No Mail Selected</h3></div>'),$("#filter-mail").html('<a class="button tiny warning" id="filter-button" onClick="filterFolder( \''+e+"', "+o+' );">'+n+" System Messages</a>")},error:function(){showError("<strong>Wait, what??</strong><br>An error occurred, and we could not filter as you indicated. Please try again later.")}})}function composeMessage(e){var t="/user/newmail";e&&(t=t+"/"+e),$.ajax({url:t,dataType:"json",type:"GET",success:function(e){if(e[0].success<1)return showError(e[0].message),!1;$("#user-mail-display").html(e[0].content)},error:function(){showError("<strong>Wait, what??</strong><br>An error occurred, and we could not load the compose form. Please try again later.")}})}function input_autocomplete(e){var t={url:function(e){return"/util/username_ac"},getValue:function(e){return e.username},ajaxSettings:{dataType:"json",method:"GET",data:{dataType:"json"}},preparePostData:function(t){return t.phrase=$(e).val(),t},template:{type:"description",fields:{description:"full_name"}},list:{match:{enabled:!0},sort:{enabled:!0},showAnimation:{type:"slide",time:400,callback:function(){}},hideAnimation:{type:"slide",time:400,callback:function(){}},maxNumberOfElements:10},theme:"plate-dark",requestDelay:400};jQuery(e).easyAutocomplete(t)}function validateAndSend(e){var t=$(e).attr("action"),a={recipient:document.querySelector('[name="recipient"]').value,subject:document.querySelector('[name="subject"]').value,body:CKEDITOR.instances.message_body.getData()};$.ajax({url:t,data:a,dataType:"json",method:"GET",success:function(e){if(e[0].success<1)return showError(e[0].message),!1;$("#user-mail-display").html(e[0].content)},error:function(){showError("<strong>Oh, man!</strong><br>An error occurred, and we could not send your message. Please try again later.")}})}function getCheckedBoxes(e){return $("input:checkbox[name='delete_mail']:checked").map(function(){return $(this).val()}).get()}function deleteMessages(e){var t={delete_ids:[e]};$.ajax({url:"/user/mail/delete",data:t,dataType:"json",method:"GET",traditional:!0,success:function(t){if(t[0].success<1)return showError(t[0].message),!1;$.each(e,function(e,t){$("#"+t).remove()}),$("#user-mail-display").html('<div class="text-center"><h3>No Mail Selected</h3></div>'),showSuccess(t[0].message)},error:function(){showError("<strong>Oh, man!</strong><br>An error occurred, and we could not delete anything. Please try again later.")}})}function saveComment(e){var t=$(e).attr("action"),a={thread_id:void 0!==document.querySelector('[name="reply_thread_id"]').value?document.querySelector('[name="reply_thread_id"]').value:"",rating:void 0!==document.querySelector('[name="rating"]').value?document.querySelector('[name="rating"]').value:0,private:1==$('input[name="private"]').prop("checked")?1:0,comment:CKEDITOR.instances.new_comment.getData()};$.ajax({url:t,data:a,dataType:"json",method:"POST",success:function(e){if(e[0].success<1)return showError(e[0].message),!1;"undefined"!=typeof thread_id&&""!==thread_id?$("#t"+thread_id).append(e[0].content):$("#comment-container").append('<div id="'+e[0].thread_id+'">'+e[0].content+"</div>"),jQuery("#rating-"+e[0].comment_id).starrr({readOnly:!0,rating:a.rating}),$("#comment_count").html(function(e,t){return 1*t+1}),jQuery("#new_comment_rating").starrr({rating:0}),$('input[name="reply_thread_id"]').val(""),$('input[name="private"]').prop("checked",!1),CKEDITOR.instances.new_comment.setData(""),showSuccess(e[0].message)},error:function(){showError("<strong>Oh, man!</strong><br>An error occurred, and we could not save your comment. Please try again later.")}})}function quoteComment(e,t,a,r){var o=$("#comment-"+t).html();void 0===r&&(r="Unknown User"),CKEDITOR.instances.new_comment.setData(r+" wrote:<br>\n<blockquote>"+o+"</blockquote>",function(){this.checkDirty()}),1==a?$('input[name="private"]').prop("checked",!0):$('input[name="private"]').prop("checked",!1),$('input[name="reply_thread_id"]').val(e),scrollToAnchor("#comment-form")}function deleteComment(e,t){var a="/content/"+e+"/comment/"+t+"/delete";$.ajax({url:a,method:"GET",dataType:"json",success:function(e){if(e[0].success<1)return showError(e[0].message),!1;$("#c"+t).remove(),$("#comment_count").html(function(e,t){return 1*t-1}),showSuccess(e[0].message)},error:function(){showError("<strong>Oh, man!</strong><br>An error occurred, and we could not delete your comment. Please try again later.")}})}function togglePublic(e,t){if(void 0===e)return!1;void 0===t&&(t=1);var a="/comment/toggle_privacy/"+e+"/"+t;$.ajax({url:a,method:"GET",dataType:"json",success:function(a){if(a[0].success<1)return showError(a[0].message),!1;1==t?($("#c"+e).addClass("comment-section-body-private"),$("#private-tag-"+e).html("<h6>PRIVATE COMMENT</h6>"),$("#privacy-"+e).html('<a class="button warning tiny" onClick="togglePublic('+e+', 0);"><i class="fa fa-eye"></i> Make Public</a>')):($("#c"+e).removeClass("comment-section-body-private"),$("#private-tag-"+e).html(""),$("#privacy-"+e).html('<a class="button warning tiny" onClick="togglePublic('+e+', 1);"><i class="fa fa-eye-slash"></i> Make Private</a>')),showSuccess(a[0].message)},error:function(){showError("<strong>Oh, man!</strong><br>An error occurred, and we could not change the privacy your comment. Please try again later.")}})}function scrollToAnchor(e){var t=$(e);$("html,body").animate({scrollTop:t.offset().top},"slow")}function toggleFilter(e,t){e.checked?$("#filter-indicator-"+t).html("<strong>Filtered</strong>"):$("#filter-indicator-"+t).html("Unfiltered")}function toggleFilterRow(e){var t="#filter-"+e,a="#indicator-wrap-"+e;$(t).prop("checked")?($(t).attr("checked",!1),$(a).html("Unfiltered"),$(a).removeClass("warning").addClass("primary")):($(t).attr("checked",!0),$(a).html("Filtered"),$(a).removeClass("primary").addClass("warning"))}function ui_multi_add_file(e,t){var a=$("#files-template").text();a=a.replace("%%filename%%",t.name),(a=$(a)).prop("id","uploaderFile"+e),a.data("file-id",e),$("#files").find("li.empty").fadeOut(),$("#files").prepend(a)}function ui_multi_update_file_status(e,t,a){$("#file-status").find("span").html(a).prop("class",t)}function ui_multi_update_file_progress(e,t,a,r){a=void 0!==a&&a;var o=$("#avatar-upload"),n=$("#avatar-upload").find("span.progress-meter"),s=$("#avatar-upload").find("p.progress-meter-text");o.attr("aria-valuenow",t),n.width(t+"%"),0===t?s.html(""):s.html(t+"%"),!1!==a&&(n.removeClass("success secondary primary warning error"),n.addClass(a))}function reload_user_avatars(){$.ajax({url:"/user/avatars/refresh",method:"GET",dataType:"html",success:function(e){$("#user-avatars").html(e);var t=new Blazy({container:"#user-avatars",selector:"#user-avatars, .b-lazy, img.b-lazy",loadInvisibe:!0,offset:1,success:function(e){},error:function(e,t){"missing"===t?console.log("Blazy Data-src is missing."):"invalid"===t&&console.log("Blazy Data-src is invalid.")}});console.log("Revalidating user-avatars"),t.load("img")}})}$(".upload-tooltip").tooltipster({content:'<i class="fa fa-spinner fa-pulse fa-fw"></i><span class="sr-only">Loading...</span>',contentAsHTML:!0,theme:"tooltipster-light",animation:"fade",interactive:!0,functionBefore:function(e,t){var a=$(t.origin),r=a.attr("data-tooltipster"),o="";r&&(r=JSON.parse(r),$.each(r,function(e,t){o=t})),!0!==a.data("loaded")&&$.get("/upload-tooltip/"+o,function(t){e.content(t),a.data("loaded",!0)})}}),$(function(){$("#avatar-uploader").dmUploader({url:"/user/avatar/upload",dnd:!0,auto:!1,maxFileSize:3e6,multiple:!1,dataType:"json",fieldName:"filename",allowedTypes:"image/*",extFilter:["jpg","jpeg","png","gif"],extraData:function(){return{title:$("#avatar-title").val()}},onDragEnter:function(){this.addClass("active")},onDragLeave:function(){this.removeClass("active")},onInit:function(){console.log("Avatar Upload initialized :)")},onComplete:function(){console.log("All pending tranfers finished")},onNewFile:function(e,t){console.log("New file added #"+e),ui_multi_add_file(e,t)},onBeforeUpload:function(e){console.log("Starting the upload of #"+e),ui_multi_update_file_status(e,"label","Uploading..."),ui_multi_update_file_progress(e,0,"",!0)},onUploadCanceled:function(e){ui_multi_update_file_status(e,"label warning","Canceled by User"),ui_multi_update_file_progress(e,0,"warning",!1)},onUploadProgress:function(e,t){ui_multi_update_file_progress(e,t)},onUploadSuccess:function(e,t){console.log("Server Response for file #"+e+": "+JSON.stringify(t)),console.log("Upload of file #"+e+" COMPLETED","success"),ui_multi_update_file_status(e,"label success","Upload Complete"),ui_multi_update_file_progress(e,100,"success",!1),$("#avatar-title").val(""),reload_user_avatars(),setTimeout(function(){$("#file-status").find("span").html("").prop("class","")},5e3)},onUploadError:function(e,t,a,r){showError("<strong>Danger, Will Robinson!</strong><br>"+r),ui_multi_update_file_progress(e,0,"alert",!1)},onFallbackMode:function(){console.log("Plugin cannot be used here, running Fallback callback")},onFileSizeError:function(e){showError("<strong>Look at the <em>size</em> of that thing!</strong><br>File '"+e.name+"' cannot be added as it exceeds the size limit of 3Mb."),console.log("File '"+e.name+"' cannot be added: size excess limit")}})}),$(document).ready(function(){$(document).on("submit","#filter-categories-form",function(e){var t="/user/settings/filter/categories/update";console.log("URL: "+t),$.ajax({url:t,method:"POST",dataType:"json",data:$("#filter-categories-form").serialize(),success:function(e){if(e[0].success<1)return console.log("received error"),showError(e[0].message),!1;console.log("showing success"),showSuccess(e[0].message)},error:function(){console.log("functional error"),showError("<strong>Well, that's not good.</strong><br>An error occurred, and we could not update your filters. Please try again later.")}}),e.preventDefault()}),$(document).on("submit","#filter-ratings-form",function(e){var t="/user/settings/filter/ratings/update";console.log("URL: "+t),$.ajax({url:t,method:"POST",dataType:"json",data:$("#filter-ratings-form").serialize(),success:function(e){if(e[0].success<1)return console.log("received error"),showError(e[0].message),!1;console.log("showing success"),showSuccess(e[0].message)},error:function(){console.log("functional error"),showError("<strong>Well, that's not good.</strong><br>An error occurred, and we could not update your filters. Please try again later.")}}),e.preventDefault()}),$("#avatar-start-upload").on("click",function(e){e.preventDefault(),$("#avatar-uploader").dmUploader("start")}),$("#avatar-stop-upload").on("click",function(e){e.preventDefault(),$("#avatar-uploader").dmUploader("cancel")}),$("#user-avatar-delete").on("click",function(e){var t=[];$("input[name|='uadelete']").each(function(e,a){if($(a).prop("checked")){var r=a.name.substring(9);t.push(r),console.log("Added ID "+r+" to the delete list.")}}),$.ajax({url:"/user/avatars/delete",method:"POST",dataType:"json",data:$.param({delete:t}),success:function(e){if(e[0].success<1)return console.log("received error"),showError(e[0].message),!1;console.log("showing success"),showSuccess(e[0].message),reload_user_avatars()},error:function(){console.log("functional error"),showError("<strong>Well, that's not good.</strong><br>An error occurred, and we could not delete your avatars. Please try again later.")}})}),new Blazy({selector:".b-lazy, img.b-lazy",container:"#page-content",success:function(e){},error:function(e,t){"missing"===t?console.log("Blazy Data-src is missing."):"invalid"===t&&console.log("Blazy Data-src is invalid.")}})});